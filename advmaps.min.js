function findPosition(){console.log("run");if(navigator.geolocation){browserSupportFlag=true;navigator.geolocation.getCurrentPosition(successCallback,errorCallback,{maximumAge:6e4,timeout:1e4,enableHighAccuracy:true})}else{drawSimpleMap();clearTimeout(location_timeout)}}function successCallback(e){loclat=e.coords.latitude;loclng=e.coords.longitude;var t=(loclat,loclng);unit_system=="METRIC"?accurate=e.coords.accuracy+"m":accurate=(e.coords.accuracy*3.28084).toFixed(3)+"ft";window.CoordsVar=t;clearTimeout(location_timeout);setter=1}function errorCallback(e){switch(e.code){case e.PERMISSION_DENIED:clearTimeout(location_timeout);drawSimpleMap();break;case e.POSITION_UNAVAILABLE:clearTimeout(location_timeout);drawSimpleMap();break;case e.TIMEOUT:clearTimeout(location_timeout);drawSimpleMap();break;case e.UNKNOWN_ERROR:clearTimeout(location_timeout);drawSimpleMap();break}}function initialize(){geocoder=new google.maps.Geocoder;for(i=0;i<numOfMaps;i++){loc=new google.maps.LatLng(loclat,loclng);dest[i]=new google.maps.LatLng(userOptions[i].lat,userOptions[i].lng);var e=userOptions[i].draggable==1?true:false;var t=userOptions[i].custom_markers==1?true:false;var n={draggable:e,suppressMarkers:t};directionsService[i]=new google.maps.DirectionsService;directionsDisplay[i]=new google.maps.DirectionsRenderer(n);var r={zoom:15,center:loc,mapTypeId:google.maps.MapTypeId[userOptions[i].type]};map[i]=new google.maps.Map(document.getElementById("advgmap"+i),r);directionsDisplay[i].setMap(map[i]);if(userOptions[i].panel!=3){document.getElementById("advgmap_dir"+i).innerHTML="";directionsDisplay[i].setPanel(document.getElementById("advgmap_dir"+i))}if(userOptions[i].accuracy==1){document.getElementById("advgmap_acc"+i).innerHTML=accurate+" "+phrase[1]}calcRoute(i)}}function calcRoute(e){var t=loc;if(userOptions[e].mode==1){var n=$("input[name=mode"+e+"]:checked").val()}else{var n="DRIVING"}var r=dest[e];var i={origin:loc,destination:dest[e],travelMode:google.maps.TravelMode[n],unitSystem:google.maps.UnitSystem[unit_system]};directionsService[e].route(i,function(i,s){var o="title_loc"+lang;var u="tooltip_loc"+lang;var a="title_dest"+lang;var f="tooltip_dest"+lang;if(s==google.maps.DirectionsStatus.OK){if(userOptions[e].custom_markers==1){switch(userOptions[e].title_loc_type){case"1":var l="geocode";break;case"2":var l=userOptions[e][o];break}switch(userOptions[e].title_dest_type){case"1":var c="geocode";break;case"2":var c=userOptions[e][a];break}switch(userOptions[e].tooltip_loc_event){case"1":var h="click";switch(userOptions[e].tooltip_loc_type){case"1":var p="geocode";break;case"2":var p=userOptions[e][u];break}break;case"2":var h="mouseover";switch(userOptions[e].tooltip_loc_type){case"1":var p="geocode";break;case"2":var p=userOptions[e][u];break}break;case"3":var h="false";var p="false";break}switch(userOptions[e].tooltip_dest_event){case"1":var d="click";switch(userOptions[e].tooltip_dest_type){case"1":var v="geocode";break;case"2":var v=userOptions[e][f];break}break;case"2":var d="mouseover";switch(userOptions[e].tooltip_dest_type){case"1":var v="geocode";break;case"2":var v=userOptions[e][f];break}break;case"3":var d="false";var v="false";break}switch(userOptions[e].animation_loc){case"1":var m="DROP";break;case"2":var m="BOUNCE";break;case"3":var m="false";break}switch(userOptions[e].animation_dest){case"1":var g="DROP";break;case"2":var g="BOUNCE";break;case"3":var g="false";break}switch(userOptions[e].animation_loc_event){case"1":var y="click";switch(userOptions[e].animation_loc_event_type){case"1":var b="DROP";break;case"2":var b="BOUNCE";break}break;case"2":var y="mouseover";switch(userOptions[e].animation_loc_event_type){case"1":var b="DROP";break;case"2":var b="BOUNCE";break}break;case"3":var y="false";var b="false";break}switch(userOptions[e].animation_dest_event){case"1":var w="click";switch(userOptions[e].animation_dest_event_type){case"1":var E="DROP";break;case"2":var E="BOUNCE";break}break;case"2":var w="mouseover";switch(userOptions[e].animation_dest_event_type){case"1":var E="DROP";break;case"2":var E="BOUNCE";break}break;case"3":var w="false";var E="false";break}setTimeout(function(){makeMarker(e,"0",r,icons.destloc,c,v,d,g,w,E)},(e+1)*userOptions[e].animation_dest_delay);setTimeout(function(){makeMarker(e,"1",t,icons.yourloc,l,p,h,m,y,b)},(e+1)*userOptions[e].animation_loc_delay);document.getElementById("advgmaps_msg"+e).style.display="none"}directionsDisplay[e].setDirections(i)}else{document.getElementById("advgmaps_msg"+e).style.display="block";document.getElementById("advgmaps_msg"+e).innerHTML="";document.getElementById("advgmaps_msg"+e).innerHTML='<i class="close icon"></i>Sorry, '+n.toLowerCase()+" directions from your location are not available.";setTimeout(function(){makeMarker(e,"0",r,icons.destloc,"geocode","geocode","click","false","false","false")},(e+1)*userOptions[e].animation_dest_delay);map[e].panTo(r)}})}function makeMarker(e,t,n,r,i,s,o,u,a,f){if(i=="geocode"||s=="geocode"){geocoder.geocode({latLng:n},function(l,c){if(c==google.maps.GeocoderStatus.OK){i=="geocode"?i=l[0].formatted_address:i=i;s=="geocode"?s=l[0].formatted_address:s=s;marker[e][t]=new google.maps.Marker({position:n,map:map[e],icon:r,title:i,animation:google.maps.Animation[u]});if(s!="false"){marker[e][t]["infowindow"]=new google.maps.InfoWindow({content:s});google.maps.event.addListener(marker[e][t],o,function(){this["infowindow"].open(map[e],this)})}if(a!="false"){google.maps.event.addListener(marker[e][t],a,function(){if(marker[e][t].getAnimation()!=null){marker[e][t].setAnimation(null)}else{setTimeout(function(){marker[e][t].setAnimation(google.maps.Animation[f])},200)}})}}else if(c=="OVER_QUERY_LIMIT"){setTimeout(function(){makeMarker(e,t,n,r,i,s,o,u,a,f)},1100)}})}else{marker[e][t]=new google.maps.Marker({position:n,map:map[e],icon:r,title:i,animation:google.maps.Animation[u]});if(s!="false"){var l="<div>"+s+"</div>";marker[e][t]["infowindow"]=new google.maps.InfoWindow({content:l});google.maps.event.addListener(marker[e][t],o,function(){this["infowindow"].open(map[e],this)})}if(a!="false"){google.maps.event.addListener(marker[e][t],a,function(){if(marker[e][t].getAnimation()!=null){marker[e][t].setAnimation(null)}else{marker[e][t].setAnimation(google.maps.Animation[f])}})}}}function drawSimpleMap(){for(j=0;j<numOfMaps;j++){(function(e){setTimeout(function(){var t=parseInt(userOptions[e].zoom);var n="<div><h5>"+phrase[2]+"</h5>"+"<h4>"+phrase[3]+"</h4>"+phrase[4]+"<br>"+"<b>"+phrase[5]+" </b> <input id='clientAddress"+e+"' type='text'>"+"<input type='button' onClick=getDir("+e+") value='"+phrase[6]+"'>";dest[e]=new google.maps.LatLng(userOptions[e].lat,userOptions[e].lng);var r={zoom:t,mapTypeId:google.maps.MapTypeId[userOptions[e].type],center:dest[e]};if(userOptions[e].accuracy==1){document.getElementById("advgmap_acc"+e).innerHTML=phrase[7]}map[e]=new google.maps.Map(document.getElementById("advgmap"+e),r);temp_loc=map[e].getCenter();geocoder=new google.maps.Geocoder;makeMarker(e,"0",temp_loc,icons.destloc,"geocode",n,"click","false","false","false")},500*(e+1))})(j)}}function getDir(e){setter=0;geocoder=new google.maps.Geocoder;geocoder.geocode({address:document.getElementById("clientAddress"+e).value},function(e,t){if(t==google.maps.GeocoderStatus.OK){loc=e[0].geometry.location;setter=1}});var t=userOptions[e].draggable==1?true:false;var n=userOptions[e].custom_markers==1?true:false;var r={draggable:t,suppressMarkers:n};marker[e][0].setMap(null);directionsService[e]=new google.maps.DirectionsService;directionsDisplay[e]=new google.maps.DirectionsRenderer(r);directionsDisplay[e].setMap(map[e]);if(userOptions[e].panel!=3){document.getElementById("advgmap_dir"+e).innerHTML="";directionsDisplay[e].setPanel(document.getElementById("advgmap_dir"+e))}whenSet("setter",function(){calcRoute(e)})}function reLocate(e){setter=0;var t=loc;findPosition();document.getElementById("advgmap_acc"+e).innerHTML=phrase[8];whenSet("setter",function(){if(userOptions[e].accuracy==1){if(accurate!="undefined"){document.getElementById("advgmap_acc"+e).innerHTML=accurate+" "+phrase[1]}else{document.getElementById("advgmap_acc"+e).innerHTML=phrase[7]}}if(t!=loc){if(userOptions[e].custom_markers==1){marker[e][0].setMap(null);marker[e][1].setMap(null)}calcRoute(e)}})}function reCalcRoute(e){if(userOptions[e].custom_markers==1){marker[e][0].setMap(null);marker[e][1].setMap(null)}calcRoute(e)}var loclat;var loclng;var accurate;var setter;var temp_loc;var directionsDisplay=[];var directionsService=[];var map=[];var dest=[];var loc;var marker=[];var icons={yourloc:new google.maps.MarkerImage(SITEURL+"/assets/locator-pin.png"),destloc:new google.maps.MarkerImage(SITEURL+"/assets/adv-pin.png")};var geocoder;
